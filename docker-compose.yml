# Cross-platform docker-compose configuration
# Supports both ARM64 and AMD64 architectures
services:
  zerotier:
    build:
      context: .
      platforms:
        - linux/arm64
        - linux/amd64
      dockerfile: Dockerfile
    image: zerotier-containerized:latest
    container_name: zerotier-containerized
    restart: unless-stopped
    network_mode: host
    privileged: true
    ports:
      - "9993:9993/udp"
    volumes:
      - zerotier-data:/var/lib/zerotier-one
    environment:
      - ZT_NETWORK=${ZT_NETWORK}
      - ZT_API_KEY=${ZT_API_KEY}
      - ZT_API_URL=${ZT_API_URL}
      - ZT_MEMBER_NAME=${ZT_MEMBER_NAME}
      - ZT_MEMBER_DESCRIPTION=${ZT_MEMBER_DESCRIPTION}
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    # Health check for monitoring container status
    healthcheck:
      test: ["CMD", "/usr/sbin/zerotier-one", "--version"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    # Labels for better identification
    labels:
      - "traefik.enable=false"
      - "zerotier.role=container"

volumes:
  zerotier-data:
    driver: local
